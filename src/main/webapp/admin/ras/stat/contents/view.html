<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<style>
#chartdiv {
	width: 100%;
	height: 260px;
}
#chartdiv2 {
	width: 100%;
	height: 500px;
}
#chartdiv3 {
	width: 100%;
	height: 250px;
}
#chartdiv4 {
	width: 100%;
	height: 250px;
}
#chartdiv_timedata_1 {
	width: 100%;
	height: 500px;
}
#chartdiv_timedata_2 {
	width: 100%;
	height: 500px;
}


.first_info_box {display: flex; width: 100%; height: auto; flex-direction: column; gap: 10px;}
.first_info_box .tit_name {flex: 1; width: 100%; font-size: 16px; font-weight: bold; height: auto; line-height: 1;}
.first_info_box .info {flex: 1; display: flex; width: 100%; height: auto; justify-content: flex-start; flex-wrap: wrap; gap: 20px; font-size: 16px; font-weight: 500; color: inherit; opacity: 0.8; line-height: 1;}
.first_info_box .info span {flex: 0 1 auto; display:inline; text-align: left; white-space: nowrap;}
.first_info_box .info span.full {flex: 1; width: 100%;}


.time_split {display: flex; width: 100%; height: auto; gap: 20px; padding: 20px;flex-wrap: wrap;}
.time_split dl {flex: 1 1 calc(25% - 20px); display: flex; flex-direction: column; position: relative; margin: 0;}
.time_split dl dt {display: flex; width: 100%; height: auto; padding: 16px; align-items: center; justify-content: center; background-color: #78909c; border-radius: 10px 10px 0 0; color: #fff; font-size: 18px; font-weight: bold; margin: 0; white-space: nowrap;}
.time_split dl dd {display: flex; width: 100%; height: auto; padding: 20px; align-items: center; justify-content: center; background-color: #eee; border-radius: 0 0 10px 10px; color: #212121; font-size: 24px; font-weight: bold; white-space: nowrap;}
.time_split dl dd::after {content: '(취약)'; display: inline; width: auto; height: auto; font-size: 0.6em; font-weight: 500; color: inherit; opacity: 0.8; margin-left: 4px;}
/* .time_split dl:first-child {margin-right: 20px;}
.time_split dl:first-child::after {content: ''; display: block; width: 1px; height: 100%; background-color: #ccc; position: absolute; right: -20px; top: 0;} */

.count_wrap {display:flex; width: 100%; height: auto; padding: 20px;}
.count_wrap .count_box {flex: 1 1 calc(100% / 5); display: flex; align-items: center; justify-content: center; gap: 20px; margin: 0;}
.count_wrap .count_box dt {display: flex; width: 72px; height: 72px; border-radius: 50%; background-color: #3f89eb; color: #fff; justify-content: center; align-items: center; font-size: 18px; font-weight: bold; margin: 0; box-shadow: 0 5px 10px #ccc;}
.count_wrap .count_box dd {display: flex; width: auto; height: auto; align-items: center; gap: 4px; font-size: 18px; font-weight: bold; margin: 0;}
.count_wrap .count_box dd > span {display: inline-block; opacity: 0.8; font-size: 0.8em; font-weight: 500;}
.caution {background-color: #ffc244!important;}
.danger {background-color: #ee7745!important;}
.accident {background-color: #ef2c32!important;}
.carelessness {background-color: #9639ef!important;}

</style>
<!-- AM 차트 4 -->
<script src="/assets/libs/amchart4/core.js"></script>
<script src="/assets/libs/amchart4/charts.js"></script>
<script src="/assets/libs/amchart4/themes/animated.js"></script>
<script src="/assets/libs/amchart4/plugins/timeline.js"></script>
<script src="/assets/libs/amchart4/plugins/bullets.js"></script>

<div id="statistics_info_wrap" class="col s12 scroller bg_lightblue h100 pd_box" style="max-height: calc(100vh - 116px); display:block;">
				
	<div class="row">
		<div class="right">
			<div class="input-field col">
				<button id="training_data_open_btn" class="waves-effect waves-light cyan btn">상세정보</button>
			</div>
		</div>
	</div>

	<div class="row">
		<input type="hidden" name="eduIdx" th:value="${eduVo?.eduIdx}"/>
		<h2 class="h2_butt mb10">기본 정보</h2>
		<div class="first_info_box">
			<!-- 공통 - 명칭 -->
			<span class="tit_name">[[${eduVo.eduTitle}]]</span>
			<div class="info">
				<!-- 훈련 -->
				<span>교수자 : [[${eduVo.teacherNm}]]</span>
				<span>
				    훈련구분 :
				    [[${eduVo.eduType == '1' ? '개인' : (eduVo.eduType == '2' ? '협동' : '기타') }]]
				</span>
				<span>훈련분야 : [[${eduVo.eduCateNm}]]</span>
				<span>훈련키워드 : [[${eduVo.eduKeyword}]]</span>
			</div>
		</div>
	</div>
	<div class="row">
		<h2 class="h2_butt">통계 정보</h2>
		<div class="row">
			<!-- <div class="helper_text_box">
				<p>훈련시간은 각 모듈의 훈련 예상 시간이며, 수행시간은 실제 훈련자의 수행 시간입니다.</p>							
			</div> -->
			<div class="time_split">
				<dl>
					<dt>주 작업자</dt>
					<dd>[[${edustatVo.mostRiskByMain}]]</dd>
				</dl>
				<dl>
					<dt>보조 작업자</dt>
					<dd>[[${edustatVo.mostRiskBySub}]]</dd>
				</dl>
				<dl>
					<dt>지상 작업자</dt>
					<dd>[[${edustatVo.mostRiskByGround}]]</dd>
				</dl>
				<dl>
					<dt>작업 책임자</dt>
					<dd>[[${edustatVo.mostRiskBySuper}]]</dd>
				</dl>
			</div>
		</div>
		<div class="row">
			<h3 class="h3_butt">역할별 사고 발생 수</h3>
			<div class="pd_box">
				<div id="chartdiv"></div>
			</div>					
		</div>
		<div class="row">
			<h3 class="h3_butt">위험요인 및 사고 발생 횟수</h3>
			<div class="count_wrap">
				<dl class="count_box">
					<dt>전체</dt>
					<dd>
						[[${eduVo.totalCnt}]]
						<span>회</span>
					</dd>
				</dl>
				<dl class="count_box">
					<dt class="caution">감전</dt>
					<dd>
						[[${eduVo.esCnt}]]
						<span>회</span>
					</dd>
				</dl>
				<dl class="count_box">
					<dt class="danger">추락</dt>
					<dd>
						[[${eduVo.fallCnt}]]
						<span>회</span>
					</dd>
				</dl>
				<dl class="count_box">
					<dt class="carelessness">부주의</dt>
					<dd>
						[[${eduVo.careCnt}]]
						<span>회</span>
					</dd>
				</dl>
				<dl class="count_box">
					<dt class="caution">작업부하</dt>
					<dd>
						[[${eduVo.loadCnt}]]
						<span>회</span>
					</dd>
				</dl>
				<dl class="count_box">
					<dt class="accident">사고</dt>
					<dd>
						[[${eduVo.accidentCnt}]]
						<span>회</span>
					</dd>
				</dl>
			</div>
		</div>

		<div class="row">
			<h3 class="h3_butt mb20">기간별 위험요인 발생 추이</h3>
			<div class="col s12">
				<!-- <div class="input-field col s1">
					<label for="scStartDate" class="active">시작일자</label>
					<input type="date" id="scStartDate" name="scStartDate" value="">
				</div>
				<div class="input-field col s1">
					<label for="scEndDate" class="active">종료일자</label>
					<input type="date" id="scEndDate" name="scEndDate" value="">
				</div> -->
				<div class="input-field col term_button_list">
					<button class="waves-effect waves-light btn" id="timedata_1" th:onclick="riskFactorByPeriod([[${eduVo.eduIdx}]], '1MONTH', 'WEEK')">1개월</button>
					<button class="waves-effect waves-light btn" id="timedata_2" th:onclick="riskFactorByPeriod([[${eduVo.eduIdx}]], '3MONTH', 'WEEK')">3개월</button>
					<button class="waves-effect waves-light btn" id="timedata_3" th:onclick="riskFactorByPeriod([[${eduVo.eduIdx}]], '6MONTH', 'MONTH')">6개월</button>
					<button class="waves-effect waves-light btn" id="timedata_4" th:onclick="riskFactorByPeriod([[${eduVo.eduIdx}]], '1YEAR', 'MONTH')">1년</button>
					<button class="waves-effect waves-light btn" id="timedata_5" th:onclick="riskFactorByPeriod([[${eduVo.eduIdx}]], '2YEAR', 'MONTH')">2년</button>
					<button class="waves-effect waves-light btn" id="timedata_6" th:onclick="riskFactorByPeriod([[${eduVo.eduIdx}]], '3YEAR', 'MONTH')">3년</button>
				</div>
			</div>
			<div class="pd_box">
				<div id="chartdiv_timedata_1"></div>
			</div>
		</div>

<!-- 
		<div class="row">
			<div class="col s12 m6 l12 xl6">
				<h3 class="h3_butt">전체 평균 수행 근육활성도</h3>
				<div class="pd_box">
					<div id="chartdiv3"></div>
				</div>
			</div>					
			<div class="col s12 m6 l12 xl6">
				<h3 class="h3_butt">전체 평균 수행 추락위험도</h3>
				<div class="pd_box">
					<div id="chartdiv4"></div>
				</div>
			</div>					
		</div>
 -->		
		<div class="row">
			<h3 class="h3_butt mb20">연간 사고 원인 TOP5 추이</h3>
			<div class="pd_box">
				<div id="chartdiv_timedata_2"></div>
			</div>
		</div>
	</div>
</div>


<div id="training_data_info_wrap" class="col s12 scroller pd_box h100" style="max-height: calc(100vh - 116px);">
	<div class="row">
		<h2 class="h2_butt col mt20 mb10">[[${eduVo.eduTitle}]]</h2>

		<div class="right">
			<div class="input-field col">
				<button id="training_data_close_btn" class="waves-effect waves-light cyan btn">통계정보</button>
			</div>
		</div>
	</div>

	<div class="row mt20">
		<div class="table_type3">
			<table id="dataTable" class="striped centered highlight">
				<colgroup>
					<col width="60px">
					<col width="140px">
					<col width="auto">
					<col width="200px">
					<col width="200px">
				</colgroup>
				<thead>
					<tr>
						<th>NO</th>
						<th>아이디</th>
						<th>성명</th>
						<th>주 역할</th>
						<th>취약 위험요인</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
	</div>

			
	<div class="row">
		<div class="col s12 m12 l12 xl4">
			<h2 class="h3_butt mt20 mb10">사고별 점유율</h2>
			<div id="chartdiv_personal_1" style="width: 100%; height:240px"></div>
		</div>
		<div class="col s12 m12 l12 xl3">
			<h2 class="h3_butt mt20 mb10">사고 위치 비교</h2>
			<div id="chartdiv_personal_2" style="width: 100%; height:240px"></div>
		</div>
		<div class="col s12 m12 l12 xl5">
			<h2 class="h3_butt mt20 mb10">사고 오브젝트 요인 Top 3</h2>
			<div id="chartdiv_personal_3" style="width: 100%; height:240px"></div>
		</div>
	</div>
			
	<h2 class="h3_butt mt20 mb10" id="memberEvent"></h2>
	<table id="dataTable2" class="dataTable  table_type3 striped centered highlight">
		<colgroup>
			<col width="80px">
			<col width="100px">
			<col width="auto">
			<col width="100px">
			<col width="80px">
			<col width="200px">
			<col width="200px">
			<col width="240px">
		</colgroup>
		<thead>
			<tr>
				<th>유형</th>
				<th>역할</th>
				<th>작업 내용</th>
				<th>공구</th>
				<th>사고 위치</th>
				<th>사고 원인</th>
				<th>사고 행동</th>
				<th>비고</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
</div>
<script>
		$(function() {
		var eduIdx = $("input[name='eduIdx']").val();
		var once = 0;
		document.querySelector('#training_data_info_wrap').style.display = 'none';
		accidentByRole(eduIdx); //역할별 사고 발생 수
// 		muscleActive(eduIdx);
// 		fallRisk(eduIdx);
		riskFactorByPeriod(eduIdx, "1MONTH", "WEEK"); // 기간별 위험요인 발생 추이
		accidentReason(eduIdx); //과정IDX
		
		// 상세정보 버튼
		document.querySelector('#training_data_open_btn').addEventListener('click', ()=>{
			document.querySelector('#statistics_info_wrap').style.display = 'none';
			document.querySelector('#training_data_info_wrap').style.display = 'block';
			if(!once > 0){
				once++;
				studentList(eduIdx);
// 				shareByAccident(eduIdx);
// 				accidentLocation(eduIdx);
// 				objectFactor(eduIdx);
			}
		});
		
		// 통계현황 버튼
		document.querySelector('#training_data_close_btn').addEventListener('click', ()=>{
			document.querySelector('#statistics_info_wrap').style.display = 'block';
			document.querySelector('#training_data_info_wrap').style.display = 'none';
		});
		
	});

function accidentByRole(eduIdx) { // chartdiv 역할별 사고 발생 수
	 $.ajax({
        url: gblAdminPath + "/ras/stat/chart/accidentByRole?eduIdx=" + eduIdx,
        type: 'GET',
        dataType: 'json',
    }).done(function (data) {
		// Parse time in HH:MM format to minutes
// 		function parseTime(time) {
// 			var parts = time.split(":");
// 			return parseInt(parts[0]) * 60 + parseInt(parts[1]);
// 		}

		am4core.ready(function() {

		// Themes begin
		am4core.useTheme(am4themes_animated);
		// Themes end

		// Create chart instance
		var chart = am4core.create("chartdiv", am4charts.XYChart);
		console.log(data.data.vo)
		
		chart.logo.disabled = true;
		// Add data
		if(data.data.accidentCntMax < 1){//no data 처리
			
		}
		
		chart.data = [
			{
				category: '주 작업자',
				danger_1: data.data.vo.mainAccidentCnt,
			},	
			{
				category: '보조 작업자',
				danger_1: data.data.vo.subAccidentCnt,
			},
			{
				category: '지상 작업자',
				danger_1: data.data.vo.groundAccidentCnt,
			},
			{
				category: '작업 책임자',
				danger_1: data.data.vo.superAccidentCnt,
			},
		];

		// Create axes
		var categoryAxis = chart.yAxes.push(new am4charts.CategoryAxis());
		categoryAxis.dataFields.category = "category";
		categoryAxis.renderer.grid.template.location = 0;
		categoryAxis.renderer.minGridDistance = 30;
		// categoryAxis.title.text = "작업자 유형";
		categoryAxis.renderer.cellStartLocation = 0.1;
		categoryAxis.renderer.cellEndLocation = 0.9;

		var valueAxis = chart.xAxes.push(new am4charts.ValueAxis());
		// valueAxis.title.text = "시간";
		valueAxis.min = 0;
		valueAxis.max = data.data.accidentCntMax; //가장 높은 값으로 설정
		// Create series
		function createSeries(field, name, color) {
			var series = chart.series.push(new am4charts.ColumnSeries());
			series.dataFields.valueX = field;
			series.dataFields.categoryY = "category";
			series.name = name;
			series.columns.template.tooltipText = "{name}: [bold]{valueX}[/] 회";
			series.columns.template.fill = am4core.color(color);
			series.stroke = am4core.color(color);

			// 데이터 값을 분으로 변환하여 툴팁에 표시
			// series.tooltip.label.adapter.add("text", function(text, target) {
			// 	var dataValue = target.dataItem.dataContext[field];
			// 	var minutes = Math.round(parseInt(dataValue) / 60);
			// 	return "{name}: [bold]" + minutes + "[/] 분";
			// });

// 			series.labels.template.disabled = true;
// 			series.ticks.template.disabled = true;
			return series;
		}

		createSeries("danger_1", "사고 발생 수", "#4989f1");
		// createSeries("danger_2", "최장 수행시간", "#00caa7");
		// createSeries("danger_3", "평균 수행시간", "#00bee6");
		// Add legend
		chart.legend = new am4charts.Legend();


		}); // end am4core.ready()
		
    }).fail(function () {
		toast.log("역할별 사고 발생 수를 불러오지 못했습니다.");
    });
}

function riskFactorByPeriod(eduIdx, period, unit){ // chartdiv_timedata_1 기간별 위험요인 발생추이
	var units = "";
	if(unit == "WEEK"){
		units = "주차"
	}else if(unit == "MONTH"){
		units = "개월차"
	}
	$.ajax({
        url: gblAdminPath + "/ras/stat/chart/riskFactorByPeriod?eduIdx=" + eduIdx +"&period="+ period + "&unit=" + unit,
        type: 'GET',
        dataType: 'json',
    }).done(function (data) {
		am4core.ready(function() {
		
			// Themes begin
			am4core.useTheme(am4themes_animated);
			// Themes end
			
			// Create chart instance
			var chart = am4core.create("chartdiv_timedata_1", am4charts.XYChart);
			chart.logo.disabled = true;
			
			// Add data dynamically based on the month value
	        chart.data = [];
	        for (var i = 0; i < data.data.list.length; i++) {
	            // Assuming data.data.list is an array with objects having properties like "teom", "caution", "danger", "accident", "carelessness"
	            
	            var chartDataItem = {
	                "teom": data.data.list[i].teom + units,
	                "total": data.data.list[i].totalCnt,
	                "es": data.data.list[i].esCnt,
	                "fall": data.data.list[i].fallCnt,
	                "care": data.data.list[i].careCnt,
	                "load": data.data.list[i].loadCnt,
	                "accident": data.data.list[i].accidentCnt
	            };
	
	            chart.data.push(chartDataItem);
	        }
			
			// Create axes
			var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
			categoryAxis.dataFields.category = "teom";
			categoryAxis.renderer.minGridDistance = 30;
			
			
			var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
			// valueAxis.renderer.inside = true;
			// valueAxis.renderer.labels.template.disabled = true;
			valueAxis.min = 0;
			
			
			// Create series
			function createSeries(field, name, color) {
			 // Set up series
			 var series = chart.series.push(new am4charts.LineSeries());
			  series.name = name;
			  series.dataFields.valueY = field;
			  series.dataFields.categoryX = "teom";
			  series.sequencedInterpolation = true;
			  series.tooltipText = "[bold]{name}[/]\n{valueY}";
			  series.stroke = am4core.color(color);
			  series.minBulletDistance = 15;
			
			  // Drop-shaped tooltips
			  series.tooltip.getFillFromObject = false;
			//   series.tooltip.background.fill = am4core.color("#000");
			  series.tooltip.background.fill = am4core.color(color);
			  series.tooltip.background.strokeOpacity = 0;
			  series.tooltip.pointerOrientation = "vertical";
			  series.tooltip.label.minWidth = 40;
			  series.tooltip.label.minHeight = 40;
			  series.tooltip.label.textAlign = "middle";
			  series.tooltip.label.textValign = "middle";
			
			  // Make bullets grow on hover
			  var bullet = series.bullets.push(new am4charts.CircleBullet());
			  bullet.circle.strokeWidth = 2;
			  bullet.circle.radius = 4;
			  bullet.circle.fill = am4core.color("#fff");
			  var bullethover = bullet.states.create("hover");
			  bullethover.properties.scale = 1.3;
			
			  return series;
			}
			
			createSeries("total", "전체", '#3f89eb');
			createSeries("es", "감전", '#ffc244');
			createSeries("fall", "추락", '#ee7745');
			createSeries("care", "부주의", '#9639ef');
			createSeries("load", "작업부하", 'ffc244 ');
			createSeries("accident", "사고", '#ef2c32');
			
			
			
			// Make a panning cursor
			chart.cursor = new am4charts.XYCursor();
			chart.cursor.behavior = "panXY";
			
			
			
			// Legend
			chart.legend = new am4charts.Legend();

		}); // end am4core.ready()

		
    }).fail(function () {
		console.log("기간별 위험요인 발생추이를 불러오지 못했습니다.");
    });
}


// function muscleActive(eduIdx) { // chartdiv3 전체 평균 수행 근육활성도
// 	 $.ajax({
//         url: gblAdminPath + "/lms/stat/chart/muscleActive?eduIdx=" + eduIdx,
//         type: 'GET',
//         dataType: 'json',
//     }).done(function (data) {
// 		am4core.ready(function() {
// 		// create chart
// 		var chart = am4core.create("chartdiv3", am4charts.GaugeChart);
// 		chart.logo.disabled = true;
// 		chart.hiddenState.properties.opacity = 0;
// 		chart.fontSize = 14;
// 		chart.innerRadius = am4core.percent(80);
// 		chart.resizable = true;
// 		// Themes begin
// 		am4core.useTheme(am4themes_animated);
// 		// Themes end
// 		var chartMin = 0;
// 		var chartMax = 100;

// 		var data = {
// 		score: 52.7,
// 		gradingData: [
// 			{
// 			title: "양호",
// 			color: "#0f9747",
// 			lowScore: 0,
// 			highScore: 20
// 			},
// 			{
// 			title: "주의",
// 			color: "#9ED136",
// 			lowScore: 20,
// 			highScore: 40
// 			},
// 			{
// 			title: "경고",
// 			color: "#f3eb0c",
// 			lowScore: 40,
// 			highScore: 60
// 			},
// 			{
// 			title: "위험",
// 			color: "#fdae19",
// 			lowScore: 60,
// 			highScore: 80
// 			},
// 			{
// 			title: "사고",
// 			color: "#ee1f25",
// 			lowScore: 80,
// 			highScore: 100
// 			}
// 		]
// 		};


// 		/**
// 		Grading Lookup
// 		*/
// 		function lookUpGrade(lookupScore, grades) {
// 		// Only change code below this line
// 		for (var i = 0; i < grades.length; i++) {
// 			if (
// 			grades[i].lowScore < lookupScore &&
// 			grades[i].highScore >= lookupScore
// 			) {
// 			return grades[i];
// 			}
// 		}
// 		return null;
// 		}
		

// 		/**
// 		 * Normal axis
// 		 */

// 		var axis = chart.xAxes.push(new am4charts.ValueAxis());
// 		axis.min = chartMin;
// 		axis.max = chartMax;
// 		axis.strictMinMax = true;
// 		axis.renderer.radius = am4core.percent(80);
// 		axis.renderer.inside = true;
// 		axis.renderer.line.strokeOpacity = 0.1;
// 		axis.renderer.ticks.template.disabled = false;
// 		axis.renderer.ticks.template.strokeOpacity = 1;
// 		axis.renderer.ticks.template.strokeWidth = 0.5;
// 		axis.renderer.ticks.template.length = 5;
// 		axis.renderer.grid.template.disabled = true;
// 		axis.renderer.labels.template.radius = am4core.percent(15);
// 		axis.renderer.labels.template.fontSize = "0.9em";

// 		/**
// 		 * Axis for ranges
// 		 */

// 		var axis2 = chart.xAxes.push(new am4charts.ValueAxis());
// 		axis2.min = chartMin;
// 		axis2.max = chartMax;
// 		axis2.strictMinMax = true;
// 		axis2.renderer.labels.template.disabled = true;
// 		axis2.renderer.ticks.template.disabled = true;
// 		axis2.renderer.grid.template.disabled = false;
// 		axis2.renderer.grid.template.opacity = 0.8;
// 		axis2.renderer.labels.template.bent = true;
// 		axis2.renderer.labels.template.fill = am4core.color("#000");
// 		axis2.renderer.labels.template.fontWeight = "bold";
// 		axis2.renderer.labels.template.fillOpacity = 0.5;



// 		/**
// 		Ranges
// 		*/

// 		for (let grading of data.gradingData) {
// 		var range = axis2.axisRanges.create();
// 		range.axisFill.fill = am4core.color(grading.color);
// 		range.axisFill.fillOpacity = 0.8;
// 		range.axisFill.zIndex = -1;
// 		range.value = grading.lowScore > chartMin ? grading.lowScore : chartMin;
// 		range.endValue = grading.highScore < chartMax ? grading.highScore : chartMax;
// 		range.grid.strokeOpacity = 0;
// 		range.stroke = am4core.color(grading.color).lighten(-0.1);
// 		range.label.inside = true;
// 		range.label.text = grading.title.toUpperCase();
// 		range.label.inside = true;
// 		range.label.location = 0.5;
// 		range.label.inside = true;
// 		range.label.radius = am4core.percent(10);
// 		range.label.paddingBottom = -5; // ~half font size
// 		range.label.fontSize = "0.9em";
// 		}

// 		var matchingGrade = lookUpGrade(data.score, data.gradingData);

// 		/**
// 		 * Label 1
// 		 */

// 		var label = chart.radarContainer.createChild(am4core.Label);
// 		label.isMeasured = false;
// 		label.fontSize = "3em";
// 		label.x = am4core.percent(50);
// 		label.paddingBottom = 15;
// 		label.horizontalCenter = "middle";
// 		label.verticalCenter = "bottom";
// 		//label.dataItem = data;
// 		label.text = data.score.toFixed(1);
// 		label.fontWeight = "bold";
// 		//label.text = "{score}";
// 		// label.fill = am4core.color(matchingGrade.color);
// 		label.fill = am4core.color("#212121");

// 		/**
// 		 * Label 2
// 		 */

// 		var label2 = chart.radarContainer.createChild(am4core.Label);
// 		label2.isMeasured = false;
// 		label2.fontSize = "1.4em";
// 		label2.horizontalCenter = "middle";
// 		label2.verticalCenter = "bottom";
// 		label2.text = matchingGrade.title.toUpperCase();
// 		label2.fill = am4core.color(matchingGrade.color);


// 		/**
// 		 * Hand
// 		 */

// 		var hand = chart.hands.push(new am4charts.ClockHand());
// 		hand.axis = axis2;
// 		hand.innerRadius = am4core.percent(55);
// 		hand.startWidth = 8;
// 		hand.pin.disabled = true;
// 		hand.value = data.score;
// 		hand.fill = am4core.color("#444");
// 		hand.stroke = am4core.color("#000");

// 		hand.events.on("positionchanged", function(){
// 		label.text = axis2.positionToValue(hand.currentPosition).toFixed(1);
// 		var value2 = axis.positionToValue(hand.currentPosition);
// 		var matchingGrade = lookUpGrade(axis.positionToValue(hand.currentPosition), data.gradingData);
// 		label2.text = matchingGrade.title.toUpperCase();
// 		label2.fill = am4core.color(matchingGrade.color);
// 		label2.stroke = am4core.color(matchingGrade.color);  
// 		label.fill = am4core.color(matchingGrade.color);
// 		})

// 		// setInterval(function() {
// 		//     var value = chartMin + Math.random() * (chartMax - chartMin);
// 		//     hand.showValue(value, 1000, am4core.ease.cubicOut);
// 		// }, 2000);

// 		}); // end am4core.ready()		
		
		
//     }).fail(function () {
// 		toast.log("전체 평균 근육 활성도를 불러오지 못했습니다.");
//     });
// }

// function fallRisk(eduIdx) { // chartdiv4 전체 평균 수행 추락 위험도
// 	 $.ajax({
//         url: gblAdminPath + "/lms/stat/chart/fallRisk?eduIdx=" + eduIdx,
//         type: 'GET',
//         dataType: 'json',
//     }).done(function (data) {
// 		am4core.ready(function() {
// 			// Themes begin
// 			am4core.useTheme(am4themes_animated);
// 			// Themes end
// 			var chartMin = 0;
// 			var chartMax = 100;

// 			var data = {
// 			score: 23.8,
// 			gradingData: [
// 				{
// 				title: "양호",
// 				color: "#0f9747",
// 				lowScore: 0,
// 				highScore: 20
// 				},
// 				{
// 				title: "주의",
// 				color: "#9ED136",
// 				lowScore: 20,
// 				highScore: 40
// 				},
// 				{
// 				title: "경고",
// 				color: "#f3eb0c",
// 				lowScore: 40,
// 				highScore: 60
// 				},
// 				{
// 				title: "위험",
// 				color: "#fdae19",
// 				lowScore: 60,
// 				highScore: 80
// 				},
// 				{
// 				title: "사고",
// 				color: "#ee1f25",
// 				lowScore: 80,
// 				highScore: 100
// 				}
// 			]
// 			};


// 			/**
// 			Grading Lookup
// 			*/
// 			function lookUpGrade(lookupScore, grades) {
// 			// Only change code below this line
// 			for (var i = 0; i < grades.length; i++) {
// 				if (
// 				grades[i].lowScore < lookupScore &&
// 				grades[i].highScore >= lookupScore
// 				) {
// 				return grades[i];
// 				}
// 			}
// 			return null;
// 			}
// 			// create chart
// 			var chart = am4core.create("chartdiv4", am4charts.GaugeChart);
// 			chart.hiddenState.properties.opacity = 0;
// 			chart.fontSize = 14;
// 			chart.innerRadius = am4core.percent(80);
// 			chart.resizable = true;
// 			chart.logo.disabled = true;
// 			/**
// 			 * Normal axis
// 			 */

// 			var axis = chart.xAxes.push(new am4charts.ValueAxis());
// 			axis.min = chartMin;
// 			axis.max = chartMax;
// 			axis.strictMinMax = true;
// 			axis.renderer.radius = am4core.percent(80);
// 			axis.renderer.inside = true;
// 			axis.renderer.line.strokeOpacity = 0.1;
// 			axis.renderer.ticks.template.disabled = false;
// 			axis.renderer.ticks.template.strokeOpacity = 1;
// 			axis.renderer.ticks.template.strokeWidth = 0.5;
// 			axis.renderer.ticks.template.length = 5;
// 			axis.renderer.grid.template.disabled = true;
// 			axis.renderer.labels.template.radius = am4core.percent(15);
// 			axis.renderer.labels.template.fontSize = "0.9em";

// 			/**
// 			 * Axis for ranges
// 			 */

// 			var axis2 = chart.xAxes.push(new am4charts.ValueAxis());
// 			axis2.min = chartMin;
// 			axis2.max = chartMax;
// 			axis2.strictMinMax = true;
// 			axis2.renderer.labels.template.disabled = true;
// 			axis2.renderer.ticks.template.disabled = true;
// 			axis2.renderer.grid.template.disabled = false;
// 			axis2.renderer.grid.template.opacity = 0.8;
// 			axis2.renderer.labels.template.bent = true;
// 			axis2.renderer.labels.template.fill = am4core.color("#000");
// 			axis2.renderer.labels.template.fontWeight = "bold";
// 			axis2.renderer.labels.template.fillOpacity = 0.5;



// 			/**
// 			Ranges
// 			*/

// 			for (let grading of data.gradingData) {
// 			var range = axis2.axisRanges.create();
// 			range.axisFill.fill = am4core.color(grading.color);
// 			range.axisFill.fillOpacity = 0.8;
// 			range.axisFill.zIndex = -1;
// 			range.value = grading.lowScore > chartMin ? grading.lowScore : chartMin;
// 			range.endValue = grading.highScore < chartMax ? grading.highScore : chartMax;
// 			range.grid.strokeOpacity = 0;
// 			range.stroke = am4core.color(grading.color).lighten(-0.1);
// 			range.label.inside = true;
// 			range.label.text = grading.title.toUpperCase();
// 			range.label.inside = true;
// 			range.label.location = 0.5;
// 			range.label.inside = true;
// 			range.label.radius = am4core.percent(10);
// 			range.label.paddingBottom = -5; // ~half font size
// 			range.label.fontSize = "0.9em";
// 			}

// 			var matchingGrade = lookUpGrade(data.score, data.gradingData);

// 			/**
// 			 * Label 1
// 			 */

// 			var label = chart.radarContainer.createChild(am4core.Label);
// 			label.isMeasured = false;
// 			label.fontSize = "3em";
// 			label.x = am4core.percent(50);
// 			label.paddingBottom = 15;
// 			label.horizontalCenter = "middle";
// 			label.verticalCenter = "bottom";
// 			//label.dataItem = data;
// 			label.text = data.score.toFixed(1);
// 			label.fontWeight = "bold";
// 			//label.text = "{score}";
// 			label.fill = am4core.color(matchingGrade.color);

// 			/**
// 			 * Label 2
// 			 */

// 			var label2 = chart.radarContainer.createChild(am4core.Label);
// 			label2.isMeasured = false;
// 			label2.fontSize = "1.4em";
// 			label2.horizontalCenter = "middle";
// 			label2.verticalCenter = "bottom";
// 			label2.text = matchingGrade.title.toUpperCase();
// 			label2.fill = am4core.color(matchingGrade.color);


// 			/**
// 			 * Hand
// 			 */

// 			var hand = chart.hands.push(new am4charts.ClockHand());
// 			hand.axis = axis2;
// 			hand.innerRadius = am4core.percent(55);
// 			hand.startWidth = 8;
// 			hand.pin.disabled = true;
// 			hand.value = data.score;
// 			hand.fill = am4core.color("#444");
// 			hand.stroke = am4core.color("#000");

// 			hand.events.on("positionchanged", function(){
// 			label.text = axis2.positionToValue(hand.currentPosition).toFixed(1);
// 			var value2 = axis.positionToValue(hand.currentPosition);
// 			var matchingGrade = lookUpGrade(axis.positionToValue(hand.currentPosition), data.gradingData);
// 			label2.text = matchingGrade.title.toUpperCase();
// 			label2.fill = am4core.color(matchingGrade.color);
// 			label2.stroke = am4core.color(matchingGrade.color);  
// 			label.fill = am4core.color(matchingGrade.color);
// 			})

// 			// setInterval(function() {
// 			//     var value = chartMin + Math.random() * (chartMax - chartMin);
// 			//     hand.showValue(value, 1000, am4core.ease.cubicOut);
// 			// }, 2000);

// 			}); // end am4core.ready()
		
//     }).fail(function () {
// 		toast.log("전체 평균 추락 위험도를 불러오지 못했습니다.");
//     });
// }
function accidentReason(eduIdx){ // chartdiv_timdata_2 //연간사고원인top5
	$.ajax({
        url: gblAdminPath + "/ras/stat/chart/accidentReason?eduIdx=" + eduIdx,
        type: 'GET',
        dataType: 'json',
    }).done(function (data) {
		
		am4core.ready(function() {
		// Themes begin
		am4core.useTheme(am4themes_animated);
		// Themes end
		
		// Create chart instance
		var chart = am4core.create("chartdiv_timedata_2", am4charts.XYChart);
		chart.logo.disabled = true;
		
		// Add data
		chart.data = [];
		for (var i = 0; i < data.data.list.length; i++) {
		    var monthData = {
		        "teom": data.data.list[i].teom + "월",
		        "object_factor_1": data.data.list[i].accidentReasonRankCnt1,
		        "object_factor_2": data.data.list[i].accidentReasonRankCnt2,
		        "object_factor_3": data.data.list[i].accidentReasonRankCnt3,
		        "object_factor_4": data.data.list[i].accidentReasonRankCnt4,
		        "object_factor_5": data.data.list[i].accidentReasonRankCnt5
		    };
		    chart.data.push(monthData);
		}

		// Create axes
		var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
		categoryAxis.dataFields.category = "teom";
		categoryAxis.renderer.grid.template.location = 0;
		
		
		var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
		valueAxis.renderer.inside = true;
		valueAxis.renderer.labels.template.disabled = true;
		valueAxis.min = 0;
		
		// Create series
		function createSeries(field, name, color) {
		  
		  // Set up series
		  var series = chart.series.push(new am4charts.ColumnSeries());
		  series.name = name;
		  series.dataFields.valueY = field;
		  series.dataFields.categoryX = "teom";
		  series.sequencedInterpolation = true;
		  series.fill = am4core.color(color);
		  series.stroke = am4core.color(color);
		  
		  // Make it stacked
		  series.stacked = true;
		  
		  // Configure columns
		  series.columns.template.width = am4core.percent(60);
		  series.columns.template.tooltipText = "[bold]{name}[/]\n{valueY}";
		  series.columns.template.tooltipText.color = am4core.color('#fff');
			series.tooltip.getFillFromObject = false;
		//   series.tooltip.background.fill = am4core.color("#000");
		  series.tooltip.background.fill = am4core.color(color);
		  series.tooltip.background.strokeOpacity = 0;
		  series.tooltip.pointerOrientation = "vertical";
		  series.tooltip.label.minWidth = 40;
		  series.tooltip.label.minHeight = 40;
		  series.tooltip.label.textAlign = "middle";
		  series.tooltip.label.textValign = "middle";
		
		
		
		  // Add label
		  var labelBullet = series.bullets.push(new am4charts.LabelBullet());
		  labelBullet.label.text = "{valueY}";
		  labelBullet.locationY = 0.5;
		  labelBullet.label.hideOversized = true;
		  
		  return series;
		}
		
		createSeries("object_factor_5", data.data.vo.accidentReasonRank5, '#ff8040');
		createSeries("object_factor_4", data.data.vo.accidentReasonRank4, '#38758b');
		createSeries("object_factor_3", data.data.vo.accidentReasonRank3, '#f7b509');
		createSeries("object_factor_2", data.data.vo.accidentReasonRank2, '#4db380');
		createSeries("object_factor_1", data.data.vo.accidentReasonRank1, '#0080ff');
		
		// Make a panning cursor
		chart.cursor = new am4charts.XYCursor();
		chart.cursor.behavior = "panXY";
		
		
		
		// Legend
		chart.legend = new am4charts.Legend();
		
		
		}); // end am4core.ready()

		
    }).fail(function () {
		console.log("연간 사고원인을 불러오지 못했습니다.");
    });
}

function shareByAccident(eduIdx, memberId) { // chartdiv_personal_1 역할별 점유율
	 $.ajax({
        url: gblAdminPath + "/ras/stat/chart/shareByAccident?eduIdx=" + eduIdx + "&memberId=" + memberId,
        type: 'GET',
        dataType: 'json',
    }).done(function (data) {
		
		am4core.ready(function() {
			am4core.useTheme(am4themes_animated);
			var chart = am4core.create("chartdiv_personal_1", am4charts.PieChart);
			chart.logo.disabled = true;
			chart.legend = new am4charts.Legend();
			chart.legend.position = "right";
		
			 chart.data = [];
			// Add data
			 for (var i = 0; i < data.data.list.length; i++) {
				if(data.data.list[0].accidentType == 'no data'){
					$("#chartdiv_personal_1").addClass("no_data");
				}
	            var chartDataItem = {
	            	"title": data.data.list[i].accidentType,
	        		"litery": data.data.list[i].accidentCnt
	            };
	
	            chart.data.push(chartDataItem);
	        }
		
			// Add and configure Series
			var pieSeries = chart.series.push(new am4charts.PieSeries());
			pieSeries.dataFields.value = "litery";
			pieSeries.dataFields.category = "title";
			pieSeries.slices.template.stroke = am4core.color("#fff");
			pieSeries.slices.template.strokeWidth = 1;
			pieSeries.slices.template.strokeOpacity = 1;
	
			// This creates initial animation
			pieSeries.hiddenState.properties.opacity = 1;
			pieSeries.hiddenState.properties.endAngle = -90;
			pieSeries.hiddenState.properties.startAngle = -90;
	
	
			// Disable ticks and labels
			pieSeries.labels.template.disabled = true;
			pieSeries.ticks.template.disabled = true;
	
			pieSeries.colors.list = [
				// am4core.color("#7760f9"),
				am4core.color("#344678"),
				am4core.color("#2e7df4"),
				am4core.color("#1da7fa"),
				am4core.color("#6af4ff"),
			];
	
		});
		
		
    }).fail(function () {
		console.log("역할별 점유율을 불러오지 못했습니다.");
    });
}

function accidentLocation(eduIdx, memberId) { // chartdiv_personal_2 사고 위치 비교
	 $.ajax({
        url: gblAdminPath + "/ras/stat/chart/accidentLocation?eduIdx=" + eduIdx + "&memberId=" + memberId,
        type: 'GET',
        dataType: 'json',
    }).done(function (data) {
		am4core.ready(function() {
			// Themes begin
			am4core.useTheme(am4themes_animated);
			// Themes end

			// Create chart instance
			var chart = am4core.create("chartdiv_personal_2", am4charts.XYChart);
			chart.logo.disabled = true;
			
			 chart.data = [];
			// Add data
			 for (var i = 0; i < data.data.list.length; i++) {
	            // Assuming data.data.list is an array with objects having properties like "teom", "caution", "danger", "accident", "carelessness"
				if(data.data.list[0].accidentLocation == 'no data'){
					$("#chartdiv_personal_2").addClass("no_data");
				}
	            var chartDataItem = {
	            	"place": data.data.list[i].accidentLocation,
	        		"count": data.data.list[i].accidentLocationCnt
	            };
	
	            chart.data.push(chartDataItem);
	        }

			// Create axes

			var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
			categoryAxis.dataFields.category = "place";
			categoryAxis.renderer.grid.template.disabled = true;
			categoryAxis.renderer.grid.template.location = 0;
			categoryAxis.renderer.minGridDistance = 30;
			categoryAxis.renderer.labels.template.adapter.add("dy", function(dy, target) {
			// if (target.dataItem && target.dataItem.index & 2 == 2) {
			// 	return dy + 25;
			// }
			return dy;
			});

			var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
			valueAxis.renderer.labels.template.fill = '#999';

			// Create series
			var series = chart.series.push(new am4charts.ColumnSeries());
			series.dataFields.valueY = "count";
			series.dataFields.categoryX = "place";
			series.name = "count";
			series.columns.template.tooltipText = "{categoryX}: [bold]{valueY}[/]";
			// series.columns.template.fillOpacity = .8;
			var gradient = new am4core.LinearGradient();
			// gradient.addColor(am4core.color("#006fdd"));
			gradient.addColor(am4core.color("#008ff6"));
			gradient.rotation = 90;
			series.columns.template.fill = gradient;
			series.columns.template.stroke = gradient;
			series.columns.template.strokeWidth = 0;


			}); // end am4core.ready()
		
    }).fail(function () {
		console.log("사고 위치비교를 불러오지 못했습니다.");
    });
}

function objectFactor(eduIdx, memberId) { // chartdiv_personal_3 사고 오브젝트 요인
	 $.ajax({
        url: gblAdminPath + "/ras/stat/chart/objectFactor?eduIdx=" + eduIdx+ "&memberId=" + memberId,
        type: 'GET',
        dataType: 'json',
    }).done(function (data) {
		am4core.ready(function() {
			// Themes begin
			am4core.useTheme(am4themes_animated);
			// Themes end

			var chart = am4core.create("chartdiv_personal_3", am4charts.XYChart);
			chart.padding(10, 10, 10, 10);
			chart.logo.disabled = true;

			var categoryAxis = chart.yAxes.push(new am4charts.CategoryAxis());
			categoryAxis.renderer.grid.template.location = 0;
			categoryAxis.dataFields.category = "accident_name";
			categoryAxis.renderer.labels.template.fill = '#fff';
			categoryAxis.renderer.labels.template.fontSize = 14;
			categoryAxis.renderer.minGridDistance = 1;
			categoryAxis.renderer.inversed = true;
			categoryAxis.renderer.grid.template.disabled = true;
			categoryAxis.renderer.inside=true;
			var valueAxis = chart.xAxes.push(new am4charts.ValueAxis());
			valueAxis.min = 0;
			valueAxis.max = data.data.accidentObjectFactorCntMax; //가장 높은 값으로 설정
			valueAxis.renderer.labels.template.fill = '#999';
			valueAxis.renderer.labels.template.fontSize = 12;
			valueAxis.renderer.grid.template.stroke = '#1da7fa';
			valueAxis.renderer.grid.template.strokeOpacity = 0;
			// dateAxis.renderer.maxGridDistance = 100;
			// valueAxis.renderer.inside=true;
			var series = chart.series.push(new am4charts.ColumnSeries());
			series.dataFields.categoryY = "accident_name";
			series.dataFields.valueX = "count";
			series.tooltipText = "[bold]{valueX.value}[/]";
			series.columns.template.strokeOpacity = 0;
			series.columns.template.column.cornerRadiusBottomRight = 5;
			series.columns.template.column.cornerRadiusTopRight = 5;

			var labelBullet = series.bullets.push(new am4charts.LabelBullet())
			labelBullet.label.horizontalCenter = "right";
			labelBullet.label.dx = -10;
			labelBullet.label.text = "{values.valueX.workingValue.formatNumber('#회')}";
			labelBullet.label.fill = am4core.color("#fff"); // accident_name 텍스트의 색상 변경
			labelBullet.label.fontSize = 16;
			labelBullet.locationX = 0;

			var gradient = new am4core.LinearGradient();
			gradient.addColor(am4core.color("#758a9d"));
			gradient.addColor(am4core.color("#56717e"));

			// 각 바에 대한 색상을 설정하는 배열
			var barColors = [
			am4core.color("#008ff6"),
			am4core.color("#00c0a8"),
			am4core.color("#00beea"),
			// am4core.color("#a674ef"),
			// am4core.color("#a0a0a0"),
			];

			
			
			// 각 바의 색상 설정
			series.columns.template.adapter.add("fill", function(fill, target){
				return barColors[target.dataItem.index % barColors.length];
			});
			
			
			if(data.data.accidentObjectFactorMax < 1){
				$("#chartdiv_personal_3").addClass("no_data");
			}
			
			chart.data = [];
			for (var i = 0; i < data.data.list.length; i++) {
	            // Assuming data.data.list is an array with objects having properties like "teom", "caution", "danger", "accident", "carelessness"
	            
	            var chartDataItem = {
            		"accident_name": data.data.list[i].accidentObjectFactor,
	        		"count": data.data.list[i].accidentObjectFactorCnt
	            };
	
	            chart.data.push(chartDataItem);
	        }
			categoryAxis.sortBySeries = series;

			}); // end am4core.ready()
		
    }).fail(function () {
		console.log("사고 오브젝트 요인을 불러오지 못했습니다.");
    });
}

//목록
function studentList(eduIdx) {
	$('#dataTable').DataTable({
		autoWidth : false,
		lengthChange : false,
		searching : false,
		bDestroy : true,
		bInfo : false,
		responsive : true,
		processing : true,
		ordering : true,
		select : true,
		paging : false,
		scrollCollapse: true,
		scrollY: '174px',
		fixedHeader : {
			header : false,
			footer : false,
		},
		ajax : {
			type : 'get',
			url : gblAdminPath + '/ras/stat/studentList?eduIdx='+eduIdx,
			dataType: "json",
			dataSrc : "data.list",
		},
		select : {
			style : 'multi',
		},
		order : [0,'desc'],
		initComplete : dataTableInit1,
		columns : [
			{ data : null, className : 'dt-body-center', render : function(data, type, row, meta) {return meta.settings._iDisplayStart + meta.row + 1;} },
			{ data : 'memberId', className : 'dt-body-center' },
			{ data : 'memberNm', className : 'dt-body-center' },
			{
				data : null, searchable : false, orderable : true, className : 'dt-body-center',
				render : function(data, type, row, meta) {
					var mostRole = row.mostRole;
					if(row.mostRole == '1'){
						mostRole = "주작업자";
					}else if(row.workRole == '2'){
						mostRole = "보조작업자";
					}else if(row.workRole == '3'){
						mostRole = "지상작업자";
					}else if(row.workRole == '4'){
						mostRole = "작업책임자";
					}
					return mostRole;
				}
			},
			{
				data : null, searchable : false, orderable : true, className : 'dt-body-center',
				render : function(data, type, row, meta) {
					var mostRisk = row.mostRisk;
					if(row.mostRisk == '1'){
						mostRisk = "감전";
					}else if(row.mostRisk == '2'){
						mostRisk = "추락";
					}else if(row.mostRisk == '3'){
						mostRisk = "부주의";
					}else if(row.mostRisk == '4'){
						mostRisk = "작업부하";
					}
					return mostRisk;
				}
			},
		],
	    createdRow: function (row, data, dataIndex) {
	        // 각 행에 대한 이벤트를 여기서 추가
	        $(row).on('click', function () {
	            // 클릭 이벤트에 대한 동작을 여기에 추가
	            changeMember(data.memberNm, data.memberId);
	            viewAccidentList(data.eduIdx, data.memberId);
	    		shareByAccident(data.eduIdx, data.memberId);
	    		accidentLocation(data.eduIdx, data.memberId);
				objectFactor(data.eduIdx, data.memberId);
	        });
	    },
	});
}

//목록
function viewAccidentList(eduIdx, memberId) {
	$('#dataTable2').DataTable({
		autoWidth : false,
		lengthChange : false,
		searching : false,
		bDestroy : true,
		bInfo : false,
		responsive : true,
		processing : true,
		ordering : true,
		select : true,
		paging : false,
		scrollCollapse: true,
		scrollY: '348px',
		fixedHeader : {
			header : false,
			footer : false,
		},
		ajax : {
			type : 'get',
			url : gblAdminPath + '/ras/stat/viewAccidentList?eduIdx=' + eduIdx + '&memberId=' + memberId,
			dataType: "json",
			dataSrc : "data.list",
		},
		select : {
			style : 'multi',
		},
		order : [1,'asc'],
		initComplete : dataTableInit2,
		columns : [
			{ data : 'accidentType', className : 'dt-body-center',}, //절차순서
			{
				data: null, searchable: false, orderable: true, className: 'dt-body-center',
				render: function (data, type, row, meta) {
					var workRole = row.workRole;
					if (row.workRole == '1') {
						workRole = "주작업자";
					} else if (row.workRole == '2') {
						workRole = "보조작업자";
					} else if (row.workRole == '3') {
						workRole = "지상작업자";
					} else if (row.workRole == '4') {
						workRole = "작업책임자";
					}
					return workRole;
				}
			},//역할
			{ data : 'processContents', className : 'dt-body-center',}, //작업내용
			{ data : 'taskTool', className : 'dt-body-center',}, //작업도구
			{ data : 'eventLocation', className : 'dt-body-center',}, //사고위치
			{ data : 'accidentCause', className : 'dt-body-center',}, //오브젝트요인
			{ data : 'accidentBehavior', className : 'dt-body-center',}, //행동요인
			{
				data: "null",
				className: "dt-body-center", //종류
				render: function (data, type, row, meta) {
					var txt = "";
					if (row.weather == "1") {
						txt += "맑음,";
					} else if (row.weather == "2") {
						txt += "폭염,";
					} else if (row.weather == "3") {
						txt += "소나기,";
					}
					if (row.c1 == "Y") {
						txt += "일반차량 충돌,";
					}
					if (row.c2 == "Y") {
						txt += "물웅덩이 생성,";
					}
					if (row.c3 == "Y") {
						txt += "통신기기 무단 발전,";
					}
					if (row.c4 == "Y") {
						txt += "가스관 파열,";
					}
					if (row.c5 == "Y") {
						txt += "CB 착오 투입,";
					}
					let txt_arr = txt.split(',');
					let txt_arr_result = '';
					txt_arr.forEach(val => {
						if (val != ''){
							txt_arr_result += `<span class="key_span">${val}</span>`
						}
					});
					return `<div class="key_box">${txt_arr_result}</div>`;
				},
			},//비고
		],
	});
}


// 데이터테이블 initComplete1
function dataTableInit1(settings, json) {
	if ($('#dataTable').DataTable().data().count() == 10000) {
		toast('데이터 조회를 10,000건으로 제한합니다.');
	}
	if (!$('#dataTable').DataTable().data().count() > 0) {
		viewAccidentList(); //수행내역이 없으면 빈 테이블로 초기화
	}
	// 마지막 행의 데이터 가져오기
    var lastRowData = $('#dataTable').DataTable().row(':first').data();
    if (lastRowData) {
        // 마지막 행의 playIdx 가져오기
        var playIdx = lastRowData.playIdx;
        // 마지막 행의 playIdx를 사용하여 함수 실행
        changeMember(lastRowData.memberNm, lastRowData.memberId);
        viewAccidentList(lastRowData.eduIdx, lastRowData.memberId);
		shareByAccident(lastRowData.eduIdx, lastRowData.memberId);
		accidentLocation(lastRowData.eduIdx, lastRowData.memberId);
		objectFactor(lastRowData.eduIdx, lastRowData.memberId);
	}
	
}

// 데이터테이블 initComplete2
function dataTableInit2(settings, json) {
	if ($('#dataTable2').DataTable().data().count() == 10000) {
		toast('데이터 조회를 10,000건으로 제한합니다.');
	}
}

function click_btn_e(){
	$('.module_list .module-item > button').removeClass('active');
	$(this).addClass('active');
}

function changeMember(memberNm, memberId){
	var name = "";
	var id = "";
	var text = "사고 이벤트 목록 - " +memberNm+"["+memberId+"]";
	
	// id가 "memberEvent"인 h2 태그를 찾아서 text를 넣음
	document.getElementById("memberEvent").innerText = text;
}
</script>	
	
